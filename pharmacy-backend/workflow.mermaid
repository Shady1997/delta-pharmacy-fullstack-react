graph TD
    Start([ðŸ Start]) --> UserReg[ðŸ‘¤ User Registration]

    UserReg --> Login[ðŸ” Login & Get JWT Token]
    Login --> Dashboard{User Role?}

    Dashboard -->|Customer| CustomerFlow[ðŸ‘¨â€ðŸ’¼ Customer Dashboard]
    Dashboard -->|Pharmacist| PharmacistFlow[ðŸ’Š Pharmacist Dashboard]
    Dashboard -->|Admin| AdminFlow[âš™ï¸ Admin Dashboard]

    %% Customer Flow
    CustomerFlow --> BrowseProducts[ðŸ” Browse Products]
    BrowseProducts --> SearchFilter[ðŸ”Ž Search & Filter Medicines]
    SearchFilter --> ViewProduct[ðŸ“‹ View Product Details]
    ViewProduct --> CheckReview[â­ Check Reviews & Ratings]

    CheckReview --> PrescCheck{Prescription<br/>Required?}
    PrescCheck -->|Yes| UploadPresc[ðŸ“¤ Upload Prescription]
    PrescCheck -->|No| AddCart[ðŸ›’ Add to Cart]

    UploadPresc --> WaitApproval[â³ Wait for Approval]
    WaitApproval --> CheckStatus[ðŸ“± Check Notification]
    CheckStatus --> PrescApproved{Approved?}

    PrescApproved -->|Yes| AddCart
    PrescApproved -->|No| ContactSupport[ðŸ’¬ Contact Support]

    AddCart --> CreateOrder[ðŸ“¦ Create Order]
    CreateOrder --> StockCheck{Stock<br/>Available?}

    StockCheck -->|No| OutOfStock[âŒ Out of Stock Notification]
    StockCheck -->|Yes| InitPayment[ðŸ’³ Initiate Payment]

    InitPayment --> PaymentGateway[ðŸ¦ Payment Gateway Mock]
    PaymentGateway --> VerifyPayment[âœ… Verify Payment]
    VerifyPayment --> PaymentSuccess{Payment<br/>Success?}

    PaymentSuccess -->|No| PaymentFailed[âŒ Payment Failed]
    PaymentFailed --> RetryPayment{Retry?}
    RetryPayment -->|Yes| InitPayment
    RetryPayment -->|No| CancelOrder[ðŸš« Cancel Order]

    PaymentSuccess -->|Yes| OrderConfirmed[âœ… Order Confirmed]
    OrderConfirmed --> UpdateStock[ðŸ“Š Update Inventory]
    UpdateStock --> OrderNotif[ðŸ“§ Order Confirmation Email]

    OrderNotif --> TrackOrder[ðŸ“ Track Order Status]
    TrackOrder --> OrderStatus{Order Status}

    OrderStatus -->|Processing| WaitShip[â³ Wait for Shipment]
    OrderStatus -->|Shipped| InTransit[ðŸšš In Transit]
    OrderStatus -->|Delivered| OrderComplete[âœ… Order Delivered]

    OrderComplete --> LeaveReview[â­ Leave Review & Rating]
    LeaveReview --> ViewHistory[ðŸ“œ View Order History]

    ContactSupport --> CreateTicket[ðŸŽ« Create Support Ticket]
    CreateTicket --> ChatBot[ðŸ¤– Chat with Pharmacist]
    ChatBot --> TicketResolved[âœ… Issue Resolved]

    %% Pharmacist Flow
    PharmacistFlow --> ViewPrescriptions[ðŸ“‹ View Pending Prescriptions]
    ViewPrescriptions --> ReviewPresc[ðŸ” Review Prescription]
    ReviewPresc --> ValidatePresc{Valid<br/>Prescription?}

    ValidatePresc -->|Yes| ApprovePresc[âœ… Approve Prescription]
    ValidatePresc -->|No| RejectPresc[âŒ Reject with Reason]

    ApprovePresc --> NotifyCustomer1[ðŸ“§ Notify Customer]
    RejectPresc --> NotifyCustomer1

    NotifyCustomer1 --> ViewOrders[ðŸ“¦ View All Orders]
    ViewOrders --> UpdateOrderStatus[ðŸ“ Update Order Status]
    UpdateOrderStatus --> ViewTickets[ðŸŽ« View Support Tickets]
    ViewTickets --> RespondTicket[ðŸ’¬ Respond to Tickets]
    RespondTicket --> ViewReports1[ðŸ“Š View Reports]

    %% Admin Flow
    AdminFlow --> ManageProducts[ðŸ¥ Manage Products]
    ManageProducts --> AddProduct[âž• Add New Product]
    ManageProducts --> UpdateProduct[âœï¸ Update Product]
    ManageProducts --> DeleteProduct[ðŸ—‘ï¸ Delete Product]

    AddProduct --> ManageInventory[ðŸ“¦ Manage Inventory]
    UpdateProduct --> ManageInventory
    DeleteProduct --> ManageInventory

    ManageInventory --> CheckStockLevels[ðŸ“Š Check Stock Levels]
    CheckStockLevels --> LowStock{Low Stock<br/>Alert?}

    LowStock -->|Yes| ReorderAlert[ðŸ”” Reorder Alert]
    LowStock -->|No| UpdateStockQty[âž•âž– Update Stock Quantity]

    ReorderAlert --> UpdateStockQty
    UpdateStockQty --> ViewAllOrders[ðŸ“¦ View All Orders]

    ViewAllOrders --> ManageOrderStatus[ðŸ“ Manage Order Statuses]
    ManageOrderStatus --> ViewPayments[ðŸ’° View Payment History]
    ViewPayments --> ViewAnalytics[ðŸ“ˆ View Analytics & Reports]

    ViewAnalytics --> SalesReport[ðŸ’µ Sales Report]
    ViewAnalytics --> InventoryReport[ðŸ“¦ Inventory Report]
    ViewAnalytics --> UsersReport[ðŸ‘¥ Users Report]

    SalesReport --> ManageUsers[ðŸ‘¤ Manage Users]
    InventoryReport --> ManageUsers
    UsersReport --> ManageUsers

    ManageUsers --> AssignRoles[ðŸŽ­ Assign Roles]
    AssignRoles --> ViewReports1

    ViewReports1 --> End([ðŸ End])
    ViewHistory --> End
    TicketResolved --> End
    CancelOrder --> End
    OutOfStock --> End

    style Start fill:#4CAF50,stroke:#333,stroke-width:4px,color:#fff
    style End fill:#F44336,stroke:#333,stroke-width:4px,color:#fff
    style Login fill:#2196F3,stroke:#333,stroke-width:2px,color:#fff
    style OrderConfirmed fill:#4CAF50,stroke:#333,stroke-width:2px,color:#fff
    style PaymentFailed fill:#F44336,stroke:#333,stroke-width:2px,color:#fff
    style ApprovePresc fill:#4CAF50,stroke:#333,stroke-width:2px,color:#fff
    style RejectPresc fill:#F44336,stroke:#333,stroke-width:2px,color:#fff
    style CustomerFlow fill:#E3F2FD,stroke:#2196F3,stroke-width:2px
    style PharmacistFlow fill:#F3E5F5,stroke:#9C27B0,stroke-width:2px
    style AdminFlow fill:#FFF3E0,stroke:#FF9800,stroke-width:2px